{% assign fid = include.feature | default: 'Feature' | slugify %}
{% assign addr = include.address | default: '1J12o2k964mJPTuS53Un7oJ2Hxo5ksYf4L' %}

<div class="mt-3">
  <button
    type="button"
    class="inline-flex items-center gap-1 text-green-700 font-semibold hover:underline"
    data-open-fund="{{ fid }}"
    aria-haspopup="dialog"
    aria-controls="fund-{{ fid }}"
  >
    Fund this feature
  </button>
</div>

<!-- Modal -->
<div
  id="fund-{{ fid }}"
  role="dialog"
  aria-modal="true"
  aria-labelledby="fund-{{ fid }}-title"
  class="fixed inset-0 z-50 hidden"
>
  <!-- Backdrop -->
  <div class="absolute inset-0 bg-black/30" data-fund-backdrop></div>

  <!-- Dialog -->
  <div class="absolute inset-0 flex items-center justify-center p-4">
    <div class="w-full max-w-md rounded-2xl bg-white shadow-xl border border-slate-200">
      <div class="p-5">
        <h2 id="fund-{{ fid }}-title" class="text-lg font-semibold">
          Fund "{{ include.feature | default: 'Feature' }}"
        </h2>
        <p class="mt-1 text-sm text-slate-600">
          You can donate in Bitcoin SV (BSV) to the address below to support development.
        </p>

        <div class="mt-4 rounded-xl border border-slate-200 bg-slate-50 p-3">
          <div class="text-xs text-slate-500">BSV address</div>
          <div class="mt-1 flex items-center justify-between gap-2">
            <code class="text-sm font-mono break-all select-all">{{ addr }}</code>
            <button
              type="button"
              class="inline-flex items-center rounded-lg bg-indigo-600 px-3 py-1.5 text-sm font-semibold text-white hover:bg-indigo-700"
              data-copy-addr="{{ fid }}"
              data-addr="{{ addr }}"
            >
              Copy
            </button>
          </div>
        </div>

        <p class="mt-3 text-xs text-slate-500">
          Thank you! Every contribution helps prioritize this work.
        </p>
      </div>

      <div class="flex items-center justify-end gap-2 border-t border-slate-200 p-3">
        <button
          type="button"
          class="inline-flex items-center rounded-lg border border-slate-300 bg-white px-3 py-1.5 text-sm font-semibold hover:bg-slate-50"
          data-close-fund="{{ fid }}"
        >
          Close
        </button>
      </div>
    </div>
  </div>
</div>

<script>
(function(){
  // open
  document.querySelectorAll('[data-open-fund="{{ fid }}"]').forEach(btn => {
    btn.addEventListener('click', () => {
      const m = document.getElementById('fund-{{ fid }}');
      if (m) m.classList.remove('hidden');
    });
  });
  // close (button or backdrop)
  document.querySelectorAll('#fund-{{ fid }} [data-fund-backdrop], [data-close-fund="{{ fid }}"]').forEach(el => {
    el.addEventListener('click', () => {
      const m = document.getElementById('fund-{{ fid }}');
      if (m) m.classList.add('hidden');
    });
  });
  // copy
  const copyBtn = document.querySelector('[data-copy-addr="{{ fid }}"]');
  if (copyBtn) {
    copyBtn.addEventListener('click', async () => {
      try {
        await navigator.clipboard.writeText(copyBtn.dataset.addr || '');
        copyBtn.textContent = 'Copied!';
        setTimeout(() => (copyBtn.textContent = 'Copy'), 1200);
      } catch (e) {}
    });
  }
})();
</script>
